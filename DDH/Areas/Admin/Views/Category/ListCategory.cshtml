@model List<DDH.Models.Category>

@{
    ViewData["Title"] = "Quản lý Danh Mục";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="container-fluid page-bg">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12 d-flex justify-content-between align-items-center">
            <div>
                <h3 class="fw-bold text-pink mb-1">
                    <i class="fas fa-tags me-2"></i>Quản lý Danh Mục
                </h3>
                <p class="text-muted mb-0">Theo dõi, chỉnh sửa và cập nhật thông tin danh mục</p>
            </div>
            <a href="/Admin/Category/CreateCategory" class="btn btn-pink shadow-sm">
                <i class="fas fa-plus me-1"></i> Thêm danh mục
            </a>
        </div>
    </div>

    <!-- Thông báo -->
    @if (!string.IsNullOrEmpty(ViewBag.Error))
    {
        <div class="alert alert-danger alert-dismissible fade show">
            <i class="fas fa-exclamation-circle me-2"></i>@ViewBag.Error
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show">
            <i class="fas fa-check-circle me-2"></i>@TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Danh sách danh mục -->
    <div class="card border-0 shadow-sm">
        <div class="card-header text-white fw-bold pink-header">
            <i class="fas fa-list me-2"></i>Danh sách danh mục (@Model.Count() mục)
        </div>
        <div class="card-body p-0 bg-white rounded-bottom">
            @if (Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="pink-table-header text-center">
                            <tr>
                                <th>ID</th>
                                <th>Tên danh mục</th>
                                <th>Trạng thái</th>
                                <th width="150">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var category in Model)
                            {
                                <tr>
                                    <td class="text-center fw-bold">@category.CategoryId</td>
                                    <td class="text-dark fw-semibold">@category.Name</td>
                                    <td class="text-center status-cell">
                                        <span class="badge @(category.IsActive ? "bg-success" : "bg-secondary")">
                                            @(category.IsActive ? "Hiển thị" : "Ẩn")
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <div class="btn-group btn-group-sm" role="group">
                                            <a href="/Admin/Category/UpdateCategory/@category.CategoryId"
                                               class="btn btn-outline-pink" data-bs-toggle="tooltip" title="Chỉnh sửa">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <button class="btn @(category.IsActive ? "btn-outline-danger" : "btn-outline-secondary")"
                                                    onclick="toggleStatus(@category.CategoryId, this)"
                                                    data-bs-toggle="tooltip" title="Ẩn / Hiện danh mục">
                                                <i class="fas @(category.IsActive ? "fa-eye" : "fa-eye-slash")"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
                    <h6 class="text-muted">Không có danh mục nào được tìm thấy.</h6>
                    <a href="/Admin/Category/CreateCategory" class="btn btn-pink mt-2">
                        <i class="fas fa-plus me-1"></i>Thêm danh mục mới
                    </a>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Tooltip Bootstrap
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });

        // Ẩn/hiện danh mục
        function toggleStatus(categoryId, btn) {
            fetch(`/Admin/Category/ToggleStatus/${categoryId}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const row = btn.closest("tr");
                        const statusCell = row.querySelector(".status-cell span");
                        if (statusCell) {
                            if (data.isActive) {
                                statusCell.textContent = "Hiển thị";
                                statusCell.classList.remove("bg-secondary");
                                statusCell.classList.add("bg-success");
                            } else {
                                statusCell.textContent = "Ẩn";
                                statusCell.classList.remove("bg-success");
                                statusCell.classList.add("bg-secondary");
                            }
                        }

                        const icon = btn.querySelector("i");
                        if (data.isActive) {
                            icon.classList.replace("fa-eye-slash", "fa-eye");
                            btn.classList.replace("btn-outline-secondary", "btn-outline-danger");
                        } else {
                            icon.classList.replace("fa-eye", "fa-eye-slash");
                            btn.classList.replace("btn-outline-danger", "btn-outline-secondary");
                        }
                    } else {
                        alert("Không thể đổi trạng thái danh mục!");
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert("Lỗi kết nối đến server!");
                });
        }
    </script>
}

<style>
    /* 🌸 Tổng thể */
    .page-bg {
        background-color: #ffe6f0; /* hồng nhạt */
        padding: 30px;
        border-radius: 12px;
    }

    /* 🌸 Header */
    .pink-header {
        background: linear-gradient(90deg, #ff66a3, #ff3385);
        color: #fff;
    }

    /* 🌸 Bảng */
    .pink-table-header {
        background-color: #ffb6c1;
        color: #6b1f3a;
        font-weight: 600;
    }

    /* 🌸 Button */
    .btn-pink {
        background-color: #ff66a3;
        color: #fff;
        border: none;
    }

        .btn-pink:hover {
            background-color: #e05590;
            color: #fff;
        }

    .btn-outline-pink {
        border: 1px solid #ff66a3;
        color: #ff66a3;
    }

        .btn-outline-pink:hover {
            background-color: #ff66a3;
            color: #fff;
        }

    /* 🌸 Text */
    .text-pink {
        color: #d63384 !important;
    }

    /* 🌸 Card */
    .card {
        border-radius: 10px;
        overflow: hidden;
    }

    .table thead th {
        text-align: center;
        vertical-align: middle;
    }

    .table td {
        vertical-align: middle;
    }

    .badge {
        font-size: 0.85rem;
    }

    @@media (max-width: 768px) {
        .btn-group {
            flex-direction: column;
        }

            .btn-group .btn {
                margin-bottom: 5px;
            }
    }
</style>
